{% autoescape xhtml_escape %}
{% extends "base.html" %}

{% block title %}{{header_title}}{% end %}

{% block container %}
    <div class="starter-template">
        <div class="page-header">
            <h1>{{header_title}} <small>{{header_subtitle}}</small></h1>
        </div>

        {% for poll in recent_polls %}
        <div class="media">
            <a class="pull-left" href="/users/{{poll['user_id']}}">
                <img class="media-object img-rounded" src="{{poll['user_avatar']}}?h=114&w=114" title="@{{poll['user_name']}}" width="57px" height="57px">
            </a>
            <div class="media-body">
                <h4 class="media-heading"><a href="/polls/{{poll['_id']}}">{{poll['question']}}</a></h4>
                <p class="">
                    Asked by <a href="/users/{{poll['user_id']}}">@{{poll['user_name']}}</a>
                    {% if poll['post_url'] %}
                    <a href="{{poll['post_url']}}" target="_blank">
                        <span class='datetime' data-datetime="{{poll['created_at']}}">{{poll['created_at']}}</span>
                    </a>
                    {% else %}
                    <span class='datetime' data-datetime="{{poll['created_at']}}">{{poll['created_at']}}</span>
                    {% end %}
                {% if len(poll['votes']) > 0 %}
                    and voted on by 
                    {% if len(poll['votes']) > 20 %}
                        {% for vote in poll['votes'][:15] %}
                        <a href="/users/{{vote['user_id']}}">
                            <img class="" src="{{vote['user_avatar']}}?h=32&w=32" title="@{{vote['user_name']}}" width="16px" height="16px"/>
                        </a>
                        {% end %}
                        {% set more=len(poll['votes']) - 15 %}
                        and {{more}} more
                    {% else %}
                        {% for vote in poll['votes'] %}
                        <a href="/users/{{vote['user_id']}}">
                            <img class="" src="{{vote['user_avatar']}}?h=32&w=32" title="@{{vote['user_name']}}" width="16px" height="16px"/>
                        </a>
                        {% end %}
                    {% end %}
                {% else %}
                    and you can be the <a href="/polls/{{poll['_id']}}">first to vote!</a>
                {% end %}
                </p>
            </div>
        </div>
        <br/>
        {% end %}

    </div>
{% end %}
